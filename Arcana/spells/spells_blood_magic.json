[
  {
    "id": "arcana_blood_magic",
    "type": "magic_type",
    "energy_source": "HP",
    "cannot_cast_flags": [ "NO_ARCANA_MAGIC", "NO_ARCANA_BLOOD_MAGIC", "NO_SPELLCASTING" ],
    "failure_cost_percent": 1,
    "max_book_level": 3,
    "cannot_cast_message": "You cannot use your blood magic now!",
    "failure_chance_formula_id": "arcana_blood_magic_failure_chance"
  },
  {
    "id": "arcana_blood_magic_corrupted_flesh",
    "type": "SPELL",
    "name": { "str": "Corrupted Flesh" },
    "description": "Using this spell will corrupt the target's flesh, preventing any natural healing from taking place and even blocking all supernatural forms of healing.",
    "message": "You fling a spray of blood at your target as you focus your malice on their body.  %s!",
    "effect": "attack",
    "shape": "blast",
    "effect_str": "effect_arcana_blood_magic_corrupted_flesh",
    "valid_targets": [ "ally", "hostile" ],
    "flags": [ "VERBAL", "SOMATIC", "NO_HANDS" ],
    "min_duration": 360000,
    "max_duration": 3960000,
    "duration_increment": 720000,
    "min_range": 2,
    "max_range": 4,
    "range_increment": 0.5,
    "max_level": 5,
    "difficulty": 60,
    "skill": "magic",
    "base_casting_time": 210,
    "final_casting_time": 105,
    "casting_time_increment": -21,
    "base_energy_cost": 28,
    "final_energy_cost": 14,
    "energy_increment": -2.8,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic",
    "ignored_monster_species": [ "ROBOT", "ROBOT_FLYING", "CYBORG" ]
  },
  {
    "id": "arcana_blood_magic_blood_knives",
    "type": "SPELL",
    "name": { "str": "Crimson Talons" },
    "description": "This spell transforms flowing blood, making it harder than steel and capable of easily slicing through flesh.  While active, you can use your talons to make vicious unarmed attacks.",
    "message": "The flowing blood forms into thick claws about your fingers.  %s!",
    "effect": "attack",
    "shape": "blast",
    "effect_str": "effect_arcana_blood_magic_blood_knives",
    "valid_targets": [ "self" ],
    "flags": [ "VERBAL", "SOMATIC", "NO_HANDS" ],
    "min_duration": 120000,
    "max_duration": 300000,
    "duration_increment": 36000,
    "max_level": 5,
    "difficulty": 50,
    "skill": "magic",
    "base_casting_time": 180,
    "final_casting_time": 90,
    "casting_time_increment": -18,
    "base_energy_cost": 24,
    "final_energy_cost": 12,
    "energy_increment": -2.4,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "id": "arcana_blood_magic_call_bloodwalker",
    "type": "SPELL",
    "name": { "str": "Calling the Bloody-Handed Walker" },
    "description": "Using this spell will summon a bloodwalker from bloodstains.  You must have at least <color_yellow>five squares of blood</color> to create the bloodwalker.\n\nIf you cast this spell after a sacrifice, the requirement for blood is <color_green>removed</color>.",
    "message": "Your gestures cause the blood to flow and coalesce, rising into the shape of a humanoid form.  %s!",
    "valid_targets": [ "self" ],
    "flags": [ "VERBAL", "SOMATIC", "NO_HANDS" ],
    "effect": "effect_on_condition",
    "shape": "blast",
    "effect_str": "EOC_BLOOD_MAGIC_CALL_BLOODWALKER",
    "difficulty": 50,
    "skill": "magic",
    "max_level": 5,
    "base_casting_time": 180,
    "final_casting_time": 90,
    "casting_time_increment": -18,
    "base_energy_cost": 24,
    "final_energy_cost": 12,
    "energy_increment": -2.4,
    "min_duration": 600000,
    "max_duration": 1500000,
    "duration_increment": 180000,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BLOOD_MAGIC_CALL_BLOODWALKER",
    "effect": [
      { "math": [ "u_blood_magic_generic_counting_variable = 0" ] },
      {
        "u_query_tile": "line_of_sight",
        "target_var": { "context_val": "summoning_loc" },
        "message": "Summon Bloodwalker",
        "range": { "math": [ "(u_spell_level('arcana_blood_magic_call_bloodwalker') * 0.6) + 4" ] }
      },
      {
        "if": { "math": [ "has_var(_summoning_loc)" ] },
        "then": {
          "u_map_run_eocs": [
            {
              "id": "EOC_BLOOD_MAGIC_CALL_BLOODWALKER_CHECK_BLOOD",
              "effect": [
                { "math": [ "u_blood_magic_generic_counting_variable += 1" ] },
                {
                  "u_transform_radius": 0,
                  "target_var": { "context_val": "bloody_terrain" },
                  "ter_furn_transform": "ter_arcana_clean_up_blood"
                }
              ]
            }
          ],
          "target_var": { "context_val": "summoning_loc" },
          "range": 2,
          "store_coordinates_in": { "context_val": "bloody_terrain" },
          "stop_at_first": false,
          "condition": { "map_field_id": "fd_blood", "loc": { "context_val": "bloody_terrain" } }
        },
        "else": { "u_message": "Canceled." }
      },
      {
        "if": { "math": [ "u_blood_magic_generic_counting_variable >= 5" ] },
        "then": {
          "u_spawn_monster": "mon_sanguine_blood_golem_summoned",
          "real_count": 1,
          "max_radius": 2,
          "target_var": { "context_val": "summoning_loc" },
          "lifespan": { "math": [ "(u_spell_level('arcana_blood_magic_call_bloodwalker') * 1800.00) + 6000.00" ] },
          "spawn_message": "The blood flows together into a humanoid form!"
        },
        "else": { "u_message": "There is not enough blood to summon the bloodwalker.", "type": "bad" }
      }
    ]
  },
  {
    "id": "arcana_mark_summon_fiend",
    "type": "SPELL",
    "name": { "str": "Calling the Denizens of Below" },
    "description": "Using this spell will summon an ashen revenant.  Whether it will obey you is <color_yellow>completely up to chance</color>.\n\nIf you cast this spell after a sacrifice, the summon will be <color_green>completely loyal</color>.",
    "message": "With a hand sign, a plume of living flame erupts from the ground, solidifying into a scorched humanoid form.  %s!",
    "valid_targets": [ "ground" ],
    "flags": [ "VERBAL", "SOMATIC", "NO_HANDS", "HOSTILE_50" ],
    "effect": "summon",
    "shape": "blast",
    "effect_str": "mon_zombie_fiend_summoned",
    "extra_effects": [ { "id": "arcana_mark_summon_fiend_sacrifice_check", "hit_self": true } ],
    "difficulty": 40,
    "skill": "magic",
    "max_level": 5,
    "min_damage": 1,
    "max_damage": 1,
    "min_range": 4,
    "max_range": 7,
    "range_increment": 0.6,
    "base_casting_time": 175,
    "final_casting_time": 160,
    "casting_time_increment": -3,
    "base_energy_cost": 20,
    "final_energy_cost": 10,
    "energy_increment": -2,
    "min_duration": 480000,
    "max_duration": 1200000,
    "duration_increment": 144000,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "id": "arcana_mark_summon_fiend_sacrifice_check",
    "type": "SPELL",
    "name": { "str": "Calling the Denizens of Below Sacrifice Check" },
    "description": "Check to see if you're able to auto-control the ashen revenants.",
    "message": "",
    "valid_targets": [ "self" ],
    "flags": [ "SILENT", "NO_HANDS" ],
    "effect": "effect_on_condition",
    "shape": "blast",
    "effect_str": "EOC_ARCANA_SUMMON_FIEND_SACRIFICE_CHECK",
    "difficulty": 50,
    "skill": "magic",
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ARCANA_SUMMON_FIEND_SACRIFICE_CHECK",
    "condition": { "or": [ { "u_has_any_effect": [ "effect_arcana_blood_magic_killed_human", "effect_arcana_blood_magic_killed" ] } ] },
    "effect": { "u_cast_spell": { "id": "arcana_mark_summon_fiend_control", "hit_self": true } }
  },
  {
    "id": "arcana_mark_summon_fiend_control",
    "type": "SPELL",
    "name": { "str": "Calling the Denizens of Below Charm Spell" },
    "description": "Charms summoned ashen revenants to make them loyal",
    "message": "",
    "valid_targets": [ "hostile" ],
    "flags": [ "SOMATIC", "NO_HANDS", "NO_EXPLOSION_SFX" ],
    "effect": "charm_monster",
    "shape": "blast",
    "min_damage": 1000,
    "max_damage": 1000,
    "skill": "magic",
    "max_level": 5,
    "min_aoe": 8,
    "min_duration": 15000000,
    "max_duration": 15000000,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic",
    "targeted_monster_ids": [ "mon_zombie_fiend_summoned" ]
  },
  {
    "id": "arcana_blood_magic_summon_jabberwock",
    "type": "SPELL",
    "name": { "str": "Fashioning the Flesh-woven Titan" },
    "description": "Using this spell will summon a golem woven of flesh, formed from a mound of nearby corpses.  If you cast this spell after a sacrifice, you will need <color_green>fewer corpses</color> to create the titan.",
    "message": "The ground warps at your command, the rotting bodies at the point pulling together, forms fusing together into an abomination.  %s!",
    "valid_targets": [ "self" ],
    "flags": [ "VERBAL", "SOMATIC", "NO_HANDS", "HOSTILE_50" ],
    "effect": "effect_on_condition",
    "effect_str": "EOC_ARCANA_BLOOD_MAGIC_SUMMON_JABBERWOCK",
    "shape": "blast",
    "difficulty": 80,
    "skill": "magic",
    "max_level": 5,
    "base_casting_time": 270,
    "final_casting_time": 135,
    "casting_time_increment": -27,
    "base_energy_cost": 36,
    "final_energy_cost": 18,
    "energy_increment": -3.6,
    "min_duration": 1080000,
    "max_duration": 2700000,
    "duration_increment": 324000,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ARCANA_BLOOD_MAGIC_SUMMON_JABBERWOCK",
    "effect": [
      { "math": [ "u_blood_magic_generic_counting_variable = 0" ] },
      {
        "u_query_tile": "line_of_sight",
        "target_var": { "context_val": "jabberwock_target_point" },
        "range": { "math": [ "(u_spell_level('arcana_blood_magic_summon_jabberwock') * 0.6) + 4" ] },
        "z_level": false,
        "message": "Select target point."
      },
      {
        "u_map_run_eocs": [
          {
            "id": "EOC_ARCANA_BLOOD_MAGIC_CHECK_FOR_CORPSE_IN_EACH_TILE",
            "effect": [
              {
                "u_map_run_item_eocs": "all",
                "loc": { "context_val": "jabberwock_corpse_check_point" },
                "min_radius": 0,
                "max_radius": 0,
                "search_data": [ { "flags": [ "CORPSE" ] } ],
                "true_eocs": [
                  {
                    "id": "EOC_ARCANA_BLOOD_MAGIC_CHECK_FOR_CORPSE_REMOVE_CORPSE",
                    "effect": [ { "math": [ "u_blood_magic_generic_counting_variable ++" ] }, "npc_die" ]
                  }
                ]
              }
            ]
          }
        ],
        "range": 2,
        "store_coordinates_in": { "context_val": "jabberwock_corpse_check_point" },
        "stop_at_first": false,
        "condition": { "math": [ "1 == 1" ] },
        "target_var": { "context_val": "jabberwock_target_point" }
      },
      { "u_message": "You found <u_val:blood_magic_generic_counting_variable> corpses.", "type": "debug" },
      {
        "if": { "u_has_effect": "effect_arcana_blood_magic_killed_human" },
        "then": { "math": [ "_jabberwock_summon_bonus = 4" ] }
      },
      {
        "if": { "u_has_effect": "effect_arcana_blood_magic_killed" },
        "then": { "math": [ "_jabberwock_summon_bonus = 2" ] }
      },
      {
        "u_message": "Your total bonus is <u_val:blood_magic_generic_counting_variable> + <context_val:jabberwock_summon_bonus>.",
        "type": "debug"
      },
      {
        "switch": { "math": [ "u_blood_magic_generic_counting_variable + _jabberwock_summon_bonus" ] },
        "cases": [
          { "case": 0, "effect": [ { "u_message": "With no flesh to mold, the ritual fails.", "type": "bad" } ] },
          {
            "case": 1,
            "effect": [
              {
                "u_cast_spell": { "id": "arcana_blood_magic_summon_jabberwock_flesh_wall_summon" },
                "loc": { "context_val": "jabberwock_target_point" }
              },
              {
                "u_message": "The flesh writhes and warps together, limbs and faces reaching out, before collapsing back into a solid mass.  There were not enough corpses to spawn the titan.",
                "type": "bad"
              }
            ]
          },
          {
            "case": 5,
            "effect": [
              {
                "u_cast_spell": { "id": "arcana_blood_magic_summon_jabberwock_jabberwock_summon" },
                "loc": { "context_val": "jabberwock_target_point" }
              },
              {
                "u_message": "The flesh writhes and warps together, limbs and faces reaching out, before a patchwork monstrosity rises up with a roar!",
                "type": "good"
              }
            ]
          },
          {
            "case": 10,
            "effect": [
              {
                "u_cast_spell": { "id": "arcana_blood_magic_summon_jabberwock_jabberwock_titan_summon" },
                "loc": { "context_val": "jabberwock_target_point" }
              },
              {
                "u_message": "The flesh writhes and warps together, limbs and faces reaching out, before a patchwork monstrosity rises up with a roar!",
                "type": "good"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "id": "arcana_blood_magic_summon_jabberwock_flesh_wall_summon",
    "type": "SPELL",
    "name": { "str": "Calling the Flesh-woven Titan Flesh Wall", "//~": "NO_I18N" },
    "description": { "str": "Summons a flesh wall if you don't have enough corpses for a jabberwock", "//~": "NO_I18N" },
    "message": "",
    "valid_targets": [ "ground", "hostile", "ally" ],
    "flags": [ "SILENT", "NO_HANDS" ],
    "effect": "summon",
    "shape": "blast",
    "effect_str": "mon_zombie_living_wall",
    "skill": "magic",
    "max_level": 5,
    "min_damage": 1,
    "max_damage": 1,
    "min_range": 60,
    "max_range": 60,
    "min_aoe": 1,
    "max_aoe": 1,
    "min_duration": 1080000,
    "max_duration": 2700000,
    "duration_increment": 324000
  },
  {
    "id": "arcana_blood_magic_summon_jabberwock_jabberwock_summon",
    "type": "SPELL",
    "name": { "str": "Calling the Flesh-woven Titan Jabberwock", "//~": "NO_I18N" },
    "description": { "str": "Summons a jabberwock if you do have enough corpses for a jabberwock", "//~": "NO_I18N" },
    "message": "",
    "valid_targets": [ "ground", "hostile", "ally" ],
    "flags": [ "SILENT", "NO_HANDS" ],
    "effect": "summon",
    "shape": "blast",
    "effect_str": "mon_jabberwock_summoned",
    "skill": "magic",
    "max_level": 5,
    "min_damage": 1,
    "max_damage": 1,
    "min_range": 60,
    "max_range": 60,
    "min_aoe": 1,
    "max_aoe": 1,
    "min_duration": 1080000,
    "max_duration": 2700000,
    "duration_increment": 324000
  },
  {
    "id": "arcana_blood_magic_summon_jabberwock_jabberwock_titan_summon",
    "type": "SPELL",
    "name": { "str": "Calling the Flesh-woven Titan Jabberwock summon", "//~": "NO_I18N" },
    "description": { "str": "Summons a jabberwock titan if you have extra corpses", "//~": "NO_I18N" },
    "message": "",
    "valid_targets": [ "ground", "hostile", "ally" ],
    "flags": [ "SILENT", "NO_HANDS" ],
    "effect": "summon",
    "shape": "blast",
    "effect_str": "mon_jabberwock_titan_summoned",
    "skill": "magic",
    "max_level": 5,
    "min_damage": 1,
    "max_damage": 1,
    "min_range": 60,
    "max_range": 60,
    "min_aoe": 1,
    "max_aoe": 1,
    "min_duration": 1080000,
    "max_duration": 2700000,
    "duration_increment": 324000
  },
  {
    "id": "arcana_mark_surge_adrenaline",
    "type": "SPELL",
    "name": { "str": "Surge of Fury" },
    "description": "Using this spell will provoke a rush of adrenaline for urgent situations, with none of the normal drawbacks.  That is not to say it has no drawbacks, as your mind will be filled with thoughts of violence.  It can only be used on yourself.",
    "message": "Your gestures provokes a rush of instinct, urging you to kill.  %s!",
    "valid_targets": [ "self" ],
    "flags": [ "SOMATIC", "NO_HANDS" ],
    "effect_str": "adrenaline_arcana_blood_magic",
    "max_level": 5,
    "effect": "attack",
    "shape": "blast",
    "base_casting_time": 90,
    "final_casting_time": 45,
    "casting_time_increment": -9,
    "base_energy_cost": 12,
    "final_energy_cost": 6,
    "energy_increment": -1.2,
    "difficulty": 20,
    "skill": "magic",
    "min_duration": 36000,
    "max_duration": 180000,
    "duration_increment": 28800,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "id": "arcana_blood_magic_drain_energy",
    "type": "SPELL",
    "name": { "str": "Enervation" },
    "description": "Using this spell will drain the energy from your target, slowing them slightly and restoring your own sleepiness and stamina.  Using it more than once on the same target in a short period of time has no effect.",
    "valid_targets": [ "ally", "hostile" ],
    "message": "You gesture, and the air between you and your target turns faintly crimson.  %s!",
    "flags": [ "VERBAL", "SOMATIC", "NO_HANDS" ],
    "extra_effects": [ { "id": "arcana_aftermath_drain_energy_damage", "hit_self": true, "max_level": 5 } ],
    "effect": "effect_on_condition",
    "shape": "blast",
    "effect_str": "EOC_ARCANA_BLOOD_MAGIC_DRAIN_ENERGY",
    "difficulty": 50,
    "skill": "magic",
    "max_level": 5,
    "min_range": 5,
    "max_range": 15,
    "range_increment": 2,
    "base_casting_time": 250,
    "final_casting_time": 110,
    "casting_time_increment": -28,
    "base_energy_cost": 24,
    "final_energy_cost": 12,
    "energy_increment": -2,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic",
    "ignored_monster_species": [ "ROBOT", "ROBOT_FLYING" ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ARCANA_BLOOD_MAGIC_DRAIN_ENERGY",
    "condition": { "not": { "u_has_effect": "effect_arcana_blood_magic_drain_energy" } },
    "effect": [
      {
        "u_add_effect": "effect_arcana_blood_magic_drain_energy",
        "duration": { "math": [ "(n_spell_level('arcana_blood_magic_drain_energy') * 60) + 120" ] }
      },
      { "math": [ "n_val('sleepiness')", "-=", "(n_spell_level('arcana_blood_magic_drain_energy') * 5) + 25" ] },
      { "math": [ "n_val('sleep_deprivation') = 0" ] }
    ]
  },
  {
    "id": "arcana_blood_magic_increased_healing",
    "type": "SPELL",
    "name": { "str": "Carmine Vitality" },
    "description": "Using this spell will increase your natural healing rate, though taking any further damage will disrupt the effect.  It may be used on yourself or an ally.",
    "valid_targets": [ "self", "ally" ],
    "message": "The blood on your hands sinks into your flesh as the spell takes effect.  %s!",
    "flags": [ "VERBAL", "SOMATIC", "NO_HANDS" ],
    "effect": "effect_on_condition",
    "shape": "blast",
    "effect_str": "EOC_ARCANA_BLOOD_MAGIC_INCREASED_HEALING",
    "difficulty": 40,
    "skill": "magic",
    "max_level": 5,
    "min_range": 1,
    "max_range": 1,
    "min_duration": 720000,
    "max_duration": 2520000,
    "duration_increment": 360000,
    "base_casting_time": 5000,
    "final_casting_time": 2500,
    "casting_time_increment": -280,
    "base_energy_cost": 20,
    "final_energy_cost": 10,
    "energy_increment": -2,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic",
    "ignored_monster_species": [ "ROBOT", "ROBOT_FLYING" ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ARCANA_BLOOD_MAGIC_INCREASED_HEALING",
    "effect": [
      { "u_lose_effect": "effect_arcana_blood_magic_increased_healing" },
      {
        "u_add_effect": "effect_arcana_blood_magic_increased_healing",
        "duration": {
          "math": [
            "(7200 + (n_spell_level('arcana_blood_magic_increased_healing') * 3600) ) * ( n_effect_intensity('effect_arcana_blood_magic_killed') > -1 ? 5 : 1 ) * ( n_effect_intensity('effect_arcana_blood_magic_killed_human') > -1 ? 10 : 1 )"
          ]
        },
        "intensity": { "math": [ "n_spell_level('arcana_blood_magic_increased_healing')" ] }
      }
    ]
  },
  {
    "id": "arcana_blood_magic_rite_of_sacrifice",
    "type": "SPELL",
    "name": { "str": "The Rite of Sacrifice" },
    "description": "The most basic of the blood mage's arts, this spell sacrifices an animal and condenses the power inherit in its blood into vitae.  It is very lengthy and the animal will have to be restrained, asleep, or unconscious during the entirety of the ritual.  Only higher animals such as birds and mammals provide enough power to be worthwhile.",
    "valid_targets": [ "hostile", "ally" ],
    "message": "As the blood pools on the ground you condense its power into vitae.  %s!",
    "flags": [ "VERBAL", "SOMATIC", "NO_HANDS" ],
    "effect": "effect_on_condition",
    "effect_str": "EOC_ARCANA_BLOOD_MAGIC_RITE_OF_SACRIFICE",
    "shape": "blast",
    "difficulty": 20,
    "skill": "magic",
    "energy_source": "NONE",
    "max_level": 5,
    "min_range": 1,
    "max_range": 1,
    "base_casting_time": 720000,
    "final_casting_time": 180000,
    "casting_time_increment": -108000,
    "base_energy_cost": 0,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic",
    "targeted_monster_species": [ "BIRD", "MAMMAL" ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ARCANA_BLOOD_MAGIC_RITE_OF_SACRIFICE",
    "effect": [
      {
        "if": { "u_has_species": "BIRD" },
        "then": { "math": [ "_sacrifice_essence_amount = clamp( ( u_weight() / 25000000 ), 1, 3)" ] }
      },
      {
        "if": { "u_has_species": "MAMMAL" },
        "then": { "math": [ "_sacrifice_essence_amount = clamp( ( u_weight() / 20000000 ), 1, 10)" ] }
      },
      { "u_location_variable": { "context_val": "loc" } },
      { "u_emit": "arcana_emit_blood_sacrifice" },
      {
        "map_spawn_item": "essence_blood",
        "loc": { "context_val": "loc" },
        "count": { "math": [ "_sacrifice_essence_amount" ] }
      },
      "u_die",
      { "npc_add_effect": "effect_arcana_blood_magic_killed", "duration": 300 }
    ]
  },
  {
    "id": "arcana_blood_magic_sacrifice_healing",
    "type": "SPELL",
    "name": { "str": "Heartblood Revitalization" },
    "description": "There is power in the blood and in the death of others, and that power can be used to restore life and health to the initiate.  After a successful blood sacrifice, you may use this ritual to heal wounds and cure any illnesses the target may be suffering from.  It may be used on yourself or an ally.",
    "message": "The blood is the life.  %s!",
    "valid_targets": [ "self", "ally" ],
    "flags": [ "VERBAL", "SOMATIC", "NO_HANDS", "SILENT" ],
    "effect": "attack",
    "effect_str": "effect_arcana_blood_sacrifice_healing",
    "shape": "blast",
    "caster_condition": {
      "or": [ { "u_has_effect": "effect_arcana_blood_magic_killed_human" }, { "u_has_effect": "effect_arcana_blood_magic_killed" } ]
    },
    "difficulty": 90,
    "skill": "magic",
    "max_level": 5,
    "min_damage": { "math": [ "(u_spell_level('arcana_blood_magic_sacrifice_healing') * -3) + -4" ] },
    "max_damage": { "math": [ "(u_spell_level('arcana_blood_magic_sacrifice_healing') * -6) + -10" ] },
    "min_duration": 21600000,
    "max_duration": 21600000,
    "min_range": 3,
    "max_range": 3,
    "energy_source": "NONE",
    "base_casting_time": 5000,
    "final_casting_time": 2500,
    "casting_time_increment": -500,
    "base_energy_cost": 0,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "id": "arcana_blood_magic_blood_teleport",
    "type": "SPELL",
    "name": { "str": "Traveling the Sanguine Road" },
    "description": "While standing on a pool of blood, this ritual allows you to forge a connection to any other nearby pool of blood and travel immediately from one to the other.  Your destination does not have to be visible to you.",
    "message": "",
    "valid_targets": [ "self" ],
    "flags": [ "VERBAL", "SOMATIC", "NO_HANDS", "SILENT" ],
    "effect": "effect_on_condition",
    "shape": "blast",
    "effect_str": "EOC_ARCANA_BLOOD_MAGIC_BLOOD_TELEPORT",
    "caster_condition": { "u_is_in_field": "fd_blood" },
    "difficulty": 40,
    "skill": "magic",
    "max_level": 5,
    "base_casting_time": 150,
    "final_casting_time": 75,
    "casting_time_increment": -15,
    "base_energy_cost": 20,
    "final_energy_cost": 10,
    "energy_increment": -2,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ARCANA_BLOOD_MAGIC_BLOOD_TELEPORT",
    "effect": [
      {
        "u_query_tile": "anywhere",
        "target_var": { "context_val": "blood_teleport_location" },
        "z_level": true,
        "message": "Select blood pool."
      },
      {
        "if": { "math": [ "has_var(_blood_teleport_location)" ] },
        "then": {
          "if": { "map_field_id": "fd_blood", "loc": { "context_val": "blood_teleport_location" } },
          "then": [
            { "u_teleport": { "context_val": "blood_teleport_location" }, "force": true },
            {
              "u_message": "As the blood drips downward, you feel yourself following its path.  Traveling the Sanguine Road!",
              "type": "neutral"
            }
          ],
          "else": { "u_message": "You must select a blood pool to step to." }
        },
        "else": { "u_message": "You cancel the ritual." }
      }
    ]
  },
  {
    "id": "arcana_blood_magic_drink_blood",
    "type": "SPELL",
    "name": { "str": "Vampiric Thirst" },
    "description": "Using this spell will provoke a rush of adrenaline for urgent situations, with none of the normal drawbacks.  That is not to say it has no drawbacks, as your mind will be filled with thoughts of violence.  It can only be used on yourself.",
    "message": "You lick your lips as images of gore arise unbidden to your thoughts.  %s!",
    "valid_targets": [ "self" ],
    "flags": [ "SOMATIC", "NO_HANDS" ],
    "effect_str": "effect_arcana_blood_magic_drink_blood",
    "max_level": 5,
    "effect": "attack",
    "shape": "blast",
    "base_casting_time": 90,
    "final_casting_time": 45,
    "casting_time_increment": -9,
    "base_energy_cost": 12,
    "final_energy_cost": 6,
    "energy_increment": -1.2,
    "difficulty": 20,
    "skill": "magic",
    "min_duration": 36000,
    "max_duration": 180000,
    "duration_increment": 28800,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "id": "arcana_blood_magic_summon_blood_sword",
    "type": "SPELL",
    "name": { "str": "Wielding the Bloody Blade" },
    "description": "This spell allows you to conjure up a blade made of flowing blood, capable of causing rending wounds and draining the life from any enemies with red (or formerly red) blood in their veins.  It will dissapate if it leaves your possession.",
    "message": "The blood coalesces into a still-flowing blade, and you reach out and grasp the hilt.  %s!",
    "effect": "summon",
    "shape": "blast",
    "effect_str": "item_arcana_summon_blood_sword",
    "valid_targets": [ "self" ],
    "flags": [ "VERBAL", "SOMATIC", "NO_HANDS" ],
    "min_duration": 360000,
    "max_duration": 3960000,
    "duration_increment": 720000,
    "max_level": 5,
    "difficulty": 60,
    "skill": "magic",
    "base_casting_time": 210,
    "final_casting_time": 105,
    "casting_time_increment": -21,
    "base_energy_cost": 24,
    "final_energy_cost": 12,
    "energy_increment": -2.4,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "id": "arcana_blood_magic_increase_health",
    "type": "SPELL",
    "name": { "str": "Bestow Vigor" },
    "description": "This spell fills the target with health and vitality, increasing their overall well-being.",
    "message": "Red tendrils surround you and float toward your target.  %s!",
    "effect": "effect_on_condition",
    "shape": "blast",
    "effect_str": "EOC_ARCANA_BLOOD_MAGIC_INCREASE_HEALTH",
    "valid_targets": [ "self", "ally" ],
    "flags": [ "VERBAL", "SOMATIC", "NO_HANDS" ],
    "max_level": 5,
    "difficulty": 30,
    "skill": "magic",
    "base_casting_time": 1200,
    "final_casting_time": 600,
    "casting_time_increment": -120,
    "base_energy_cost": 16,
    "final_energy_cost": 8,
    "energy_increment": -1.6,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ARCANA_BLOOD_MAGIC_INCREASE_HEALTH",
    "effect": [
      {
        "math": [
          "u_health() += (5 + rand(n_spell_level('arcana_blood_magic_increase_health') ) + rand(n_spell_level('arcana_blood_magic_increase_health') ) + rand(n_spell_level('arcana_blood_magic_increase_health') ) )"
        ]
      }
    ]
  }
]
