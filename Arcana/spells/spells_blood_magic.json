[
  {
    "id": "arcana_blood_magic",
    "type": "magic_type",
    "energy_source": "HP",
    "cannot_cast_flags": [ "NO_ARCANA_MAGIC", "NO_ARCANA_BLOOD_MAGIC", "NO_SPELLCASTING" ],
    "failure_cost_percent": 1,
    "max_book_level": 3,
    "cannot_cast_message": "You cannot use your blood magic now!",
    "failure_chance_formula_id": "arcana_blood_magic_failure_chance"
  },
  {
    "id": "arcana_mark_elemental_sign",
    "type": "SPELL",
    "name": { "str": "Mark: Sign of the Inferno" },
    "description": "Using this spell will grant complete immunity to fire, spreading a deathly chill and driving away flames from your immediate area.",
    "message": "With a gesture, your inner fire flares up.  %s!",
    "valid_targets": [ "self" ],
    "flags": [ "SOMATIC", "NO_HANDS" ],
    "extra_effects": [
      { "id": "arcana_aftermath_brief_cold_ward", "hit_self": true },
      { "id": "arcana_aftermath_elemental_coldness", "hit_self": false, "max_level": 5 },
      { "id": "arcana_aftermath_elemental_field_effect", "hit_self": false, "max_level": 5 },
      { "id": "arcana_aftermath_sanguine_mark_burnout_5", "hit_self": true, "max_level": 5 }
    ],
    "effect": "attack",
    "shape": "blast",
    "effect_str": "heat_ward_true_blood_magic",
    "energy_source": "HP",
    "difficulty": 50,
    "skill": "magic",
    "max_level": 5,
    "base_casting_time": 180,
    "final_casting_time": 90,
    "casting_time_increment": -18,
    "base_energy_cost": 24,
    "final_energy_cost": 12,
    "energy_increment": -2.4,
    "min_duration": 30000,
    "max_duration": 150000,
    "duration_increment": 24000,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "id": "arcana_mark_malevolent_gaze",
    "type": "SPELL",
    "name": { "str": "Mark: Malevolent Gaze" },
    "description": "Using this spell will strike a single target with a powerful temporal effect.  It won't deal any damage, but it will freeze your prey in place momentarily, leaving them slowed for a while afterward.",
    "message": "Your pupils briefly narrow into thin slits as you focus your hatred.  %s!",
    "effect": "attack",
    "shape": "blast",
    "effect_str": "effect_arcana_malevolent_gaze",
    "valid_targets": [ "ally", "hostile" ],
    "flags": [ "SILENT", "SOMATIC", "NO_HANDS" ],
    "extra_effects": [
      { "id": "arcana_aftermath_malevolent_gaze_slowdown", "hit_self": false, "max_level": 5 },
      { "id": "arcana_aftermath_sanguine_mark_burnout_5", "hit_self": true, "max_level": 5 }
    ],
    "min_duration": 1000,
    "max_duration": 2500,
    "duration_increment": 300,
    "min_range": 5,
    "max_range": 10,
    "range_increment": 1,
    "max_level": 5,
    "difficulty": 50,
    "skill": "magic",
    "base_casting_time": 180,
    "final_casting_time": 90,
    "casting_time_increment": -18,
    "energy_source": "HP",
    "base_energy_cost": 24,
    "final_energy_cost": 12,
    "energy_increment": -2.4,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic",
    "ignored_monster_species": [ "ROBOT", "ROBOT_FLYING" ]
  },
  {
    "id": "arcana_mark_might",
    "//": "ID retained for save compatibility reasons.",
    "type": "SPELL",
    "name": { "str": "Mark: Manifestation of Strength" },
    "description": "Using this spell will imbue your body with an unnatural aura, greatly increasing your strength and damage resistance, though with a correspondingly increased appetite.  It can only be used on yourself.",
    "valid_targets": [ "self" ],
    "flags": [ "SOMATIC", "NO_HANDS" ],
    "extra_effects": [ { "id": "arcana_aftermath_sanguine_mark_burnout_5", "hit_self": true, "max_level": 5 } ],
    "effect": "attack",
    "shape": "blast",
    "effect_str": "effect_arcana_manifestation_of_strength",
    "energy_source": "HP",
    "difficulty": 50,
    "skill": "magic",
    "max_level": 5,
    "min_damage": 1,
    "max_damage": 1,
    "base_casting_time": 180,
    "final_casting_time": 90,
    "casting_time_increment": -18,
    "base_energy_cost": 24,
    "final_energy_cost": 12,
    "energy_increment": -2.4,
    "min_duration": 60000,
    "max_duration": 150000,
    "duration_increment": 18000,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "id": "arcana_mark_revenant_blood",
    "type": "SPELL",
    "name": { "str": "Mark: Revenant Blood" },
    "description": "Using this spell will guard against poison, protect against pestilence in food and water, and burn out fungal influences or other parasites.",
    "message": "With a sign, you feel your blood burning with magical power.  %s!",
    "valid_targets": [ "self" ],
    "flags": [ "SOMATIC", "NO_HANDS" ],
    "extra_effects": [ { "id": "arcana_aftermath_sanguine_mark_burnout_4", "hit_self": true, "max_level": 5 } ],
    "effect": "attack",
    "shape": "blast",
    "effect_str": "dragonblood_clarity",
    "energy_source": "HP",
    "difficulty": 40,
    "skill": "magic",
    "max_level": 5,
    "base_casting_time": 150,
    "final_casting_time": 75,
    "casting_time_increment": -15,
    "base_energy_cost": 20,
    "final_energy_cost": 10,
    "energy_increment": -2,
    "min_duration": 48000,
    "max_duration": 120000,
    "duration_increment": 14400,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "id": "arcana_mark_summon_dark_wyrm",
    "type": "SPELL",
    "name": { "str": "Mark: Calling the Worms of the Earth" },
    "description": "Using this spell will summon a dark wyrm.  Whether it will obey you is completely up to chance.",
    "message": "Your gesture causes the ground to shift and flow, a pitch-black form slithering out of the earth itself.  %s!",
    "valid_targets": [ "ground" ],
    "flags": [ "SOMATIC", "NO_HANDS", "HOSTILE_50" ],
    "extra_effects": [ { "id": "arcana_aftermath_sanguine_mark_burnout_5", "hit_self": true, "max_level": 5 } ],
    "effect": "summon",
    "shape": "blast",
    "effect_str": "mon_dark_wyrm_summoned",
    "energy_source": "HP",
    "difficulty": 50,
    "skill": "magic",
    "max_level": 5,
    "min_damage": 1,
    "max_damage": 1,
    "min_range": 4,
    "max_range": 7,
    "range_increment": 0.6,
    "base_casting_time": 180,
    "final_casting_time": 90,
    "casting_time_increment": -18,
    "base_energy_cost": 24,
    "final_energy_cost": 12,
    "energy_increment": -2.4,
    "min_duration": 600000,
    "max_duration": 1500000,
    "duration_increment": 180000,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "id": "arcana_mark_summon_fiend",
    "type": "SPELL",
    "name": { "str": "Mark: Calling the Denizens of Below" },
    "description": "Using this spell will summon an ashen revenant.  Whether it will obey you is completely up to chance.",
    "message": "With a hand sign, a plume of living flame erupts from the ground, solidifying into a scorched humanoid form.  %s!",
    "valid_targets": [ "ground" ],
    "flags": [ "SOMATIC", "NO_HANDS", "HOSTILE_50" ],
    "extra_effects": [ { "id": "arcana_aftermath_sanguine_mark_burnout_4", "hit_self": true, "max_level": 5 } ],
    "effect": "summon",
    "shape": "blast",
    "effect_str": "mon_zombie_fiend_summoned",
    "energy_source": "HP",
    "difficulty": 40,
    "skill": "magic",
    "max_level": 5,
    "min_damage": 1,
    "max_damage": 1,
    "min_range": 4,
    "max_range": 7,
    "range_increment": 0.6,
    "base_casting_time": 175,
    "final_casting_time": 160,
    "casting_time_increment": -3,
    "base_energy_cost": 20,
    "final_energy_cost": 10,
    "energy_increment": -2,
    "min_duration": 480000,
    "max_duration": 1200000,
    "duration_increment": 144000,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "id": "arcana_mark_summon_jabberwock",
    "type": "SPELL",
    "name": { "str": "Mark: Calling the Flesh-woven Titan" },
    "description": "Using this spell will summon a golem woven of flesh.  Whether it will obey you is completely up to chance.",
    "message": "The ground warps at your command, a host of rotting bodies emerging from the disturbance, forms fusing together into an abomination.  %s!",
    "valid_targets": [ "ground" ],
    "flags": [ "SOMATIC", "NO_HANDS", "HOSTILE_50" ],
    "extra_effects": [ { "id": "arcana_aftermath_sanguine_mark_burnout_6", "hit_self": true, "max_level": 5 } ],
    "effect": "summon",
    "shape": "blast",
    "effect_str": "mon_jabberwock_summoned",
    "energy_source": "HP",
    "difficulty": 60,
    "skill": "magic",
    "max_level": 5,
    "min_damage": 1,
    "max_damage": 1,
    "min_range": 4,
    "max_range": 7,
    "range_increment": 0.6,
    "base_casting_time": 210,
    "final_casting_time": 105,
    "casting_time_increment": -21,
    "base_energy_cost": 28,
    "final_energy_cost": 14,
    "energy_increment": -2.8,
    "min_duration": 720000,
    "max_duration": 1800000,
    "duration_increment": 216000,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "id": "arcana_mark_surge_adrenaline",
    "type": "SPELL",
    "name": { "str": "Mark: Surge of Fury" },
    "description": "Using this spell will provoke a rush of adrenaline for urgent situations, with none of the normal drawbacks.  That is not to say it has no drawbacks, as your mind will be filled with thoughts of violence.  It can only be used on yourself.",
    "message": "Your gestures provokes a rush of instinct, urging you to kill.  %s!",
    "valid_targets": [ "self" ],
    "flags": [ "SOMATIC", "NO_HANDS" ],
    "extra_effects": [ { "id": "arcana_aftermath_sanguine_mark_burnout_2", "hit_self": true, "max_level": 5 } ],
    "effect_str": "adrenaline_arcana_blood_magic",
    "max_level": 5,
    "effect": "attack",
    "shape": "blast",
    "base_casting_time": 90,
    "final_casting_time": 45,
    "casting_time_increment": -9,
    "base_energy_cost": 12,
    "final_energy_cost": 6,
    "energy_increment": -1.2,
    "difficulty": 20,
    "skill": "magic",
    "min_duration": 36000,
    "max_duration": 180000,
    "duration_increment": 28800,
    "energy_source": "HP",
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic"
  },
  {
    "//": "New blood magic spells begin here",
    "id": "arcana_blood_magic_drain_energy",
    "type": "SPELL",
    "name": { "str": "Mark: Enervation" },
    "description": "Using this spell will drain the energy from your target, slowing them slightly and restoring your own sleepiness and stamina.  Using it more than once on the same target in a short period of time has no effect.",
    "valid_targets": [ "ally", "hostile" ],
    "message": "You gesture, and the air between you and your target turns faintly crimson.  %s!",
    "flags": [ "SOMATIC", "NO_HANDS" ],
    "extra_effects": [
      { "id": "arcana_aftermath_drain_energy_damage", "hit_self": true, "max_level": 5 },
      { "id": "arcana_aftermath_sanguine_mark_burnout_5", "hit_self": true, "max_level": 5 }
    ],
    "effect": "effect_on_condition",
    "shape": "blast",
    "effect_str": "EOC_ARCANA_BLOOD_MAGIC_DRAIN_ENERGY",
    "energy_source": "HP",
    "difficulty": 50,
    "skill": "magic",
    "max_level": 5,
    "min_range": 5,
    "max_range": 15,
    "range_increment": 2,
    "base_casting_time": 250,
    "final_casting_time": 110,
    "casting_time_increment": -28,
    "base_energy_cost": 24,
    "final_energy_cost": 12,
    "energy_increment": -2,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic",
    "ignored_monster_species": [ "ROBOT", "ROBOT_FLYING" ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ARCANA_BLOOD_MAGIC_DRAIN_ENERGY",
    "condition": { "not": { "u_has_effect": "effect_arcana_blood_magic_drain_energy" } },
    "effect": [
      {
        "u_add_effect": "effect_arcana_blood_magic_drain_energy",
        "duration": { "math": [ "(n_spell_level('arcana_blood_magic_drain_energy') * 60) + 120" ] }
      },
      { "math": [ "n_val('sleepiness')", "-=", "(n_spell_level('arcana_blood_magic_drain_energy') * 5) + 25" ] },
      { "math": [ "n_val('sleep_deprivation') = 0" ] }
    ]
  },
  {
    "id": "arcana_blood_magic_increased_healing",
    "type": "SPELL",
    "name": { "str": "Mark: Carmine Vitality" },
    "description": "Using this spell will increase your natural healing rate and overall health, though taking any further damage will disrupt the effect.  It may be used on yourself or an ally.",
    "valid_targets": [ "self", "ally" ],
    "message": "The blood on your hands sinks into your flesh as the spell takes effect.  %s!",
    "flags": [ "SOMATIC", "NO_HANDS" ],
    "extra_effects": [ { "id": "arcana_aftermath_sanguine_mark_burnout_4", "hit_self": true, "max_level": 5 } ],
    "effect": "effect_on_condition",
    "shape": "blast",
    "effect_str": "EOC_ARCANA_BLOOD_MAGIC_INCREASED_HEALING",
    "energy_source": "HP",
    "difficulty": 40,
    "skill": "magic",
    "max_level": 5,
    "min_range": 1,
    "max_range": 1,
    "min_duration": 720000,
    "max_duration": 2520000,
    "duration_increment": 360000,
    "base_casting_time": 5000,
    "final_casting_time": 2500,
    "casting_time_increment": -280,
    "base_energy_cost": 20,
    "final_energy_cost": 10,
    "energy_increment": -2,
    "spell_class": "ARCANA_BLOOD_MAGIC",
    "magic_type": "arcana_blood_magic",
    "ignored_monster_species": [ "ROBOT", "ROBOT_FLYING" ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ARCANA_BLOOD_MAGIC_DRAIN_ENERGY",
    "effect": [
      { "u_lose_effect": "effect_arcana_blood_magic_increased_healing" },
      {
        "u_add_effect": "effect_arcana_blood_magic_increased_healing",
        "duration": {
          "math": [
            "(7200 + (n_spell_level('arcana_blood_magic_increased_healing') * 3600) ) * ( n_effect_intensity('effect_arcana_blood_magic_killed') > -1 ? 5 : 1 ) * ( n_effect_intensity('effect_arcana_blood_magic_killed_human') > -1 ? 10 : 1 )"
          ]
        },
        "intensity": { "math": [ "n_spell_level('arcana_blood_magic_increased_healing')" ] }
      }
    ]
  }
]
